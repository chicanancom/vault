import scrapy
from scrapy.linkextractors import LinkExtractor
from scrapy.spiders.crawl import CrawlSpider, Rule
from scrapy.crawler import CrawlerProcess
from scrapy_splash import SplashRequest


class MalwareBaazarSpider(scrapy.Spider):
    name = "malware_baazar"
    allowed_domains = ["bazaar.abuse.ch"]
    start_urls = ["https://bazaar.abuse.ch"]

    def start_requests(self):
        request = scrapy.Request('https://bazaar.abuse.ch/browse', callback=self.parse)
        request.meta['handle_httpstatus_all'] = True
        request.meta['dont_redirect'] = True

        yield request


    def parse(self, response):
        a = response.xpath("//text()").get()
        yield {"a":a}
process = CrawlerProcess()
process.crawl(MalwareBaazarSpider)
process.start()
